<!DOCTYPE html>
<meta charset="utf-8">
<title>libloadorder Readme</title>
<style>
    body {font-family:Helvetica,sans-serif;font-size:10pt;}
    h1 + p {text-align:center;}
    li {margin-bottom:10px;}
    li ul, li ol {margin-top:0.4em;}
    q {font-style:italic;}
    code {display:inline-block; padding:2px 5px; background:#eee;}
    td, th {border:1px solid #ddd; padding: 5px; vertical-align:top;}
    table {border-collapse:collapse; margin:1em;background:#FafaFf;}
    thead {font-weight:bold;background:#99CCFF;}
    code.box {line-height:20px; white-space:pre; margin:1em 0 0 3em; display:table; padding:5px 10px;}
    ol li ol {list-style:lower-alpha;}
    ol li ol li ol {list-style:lower-roman;}
 ol ol li {margin-bottom:0.2em;}
    blockquote {background:#E6E6FA; display:table; padding:5px 30px 5px 10px;}
    h1 {text-align:center;font-size:24pt;}
    h2 {margin-top:3em;font-size:20pt;}
    h3 {margin-top:2em;font-size:16pt;}
    h4 {margin-top:2em;font-size:12pt;}
    a:link {text-decoration:none;}
    a:hover {text-decoration:underline;}
    a[href^="http"]:after {padding-left:2px; content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAVklEQVR4Xn3PgQkAMQhDUXfqTu7kTtkpd5RA8AInfArtQ2iRXFWT2QedAfttj2FsPIOE1eCOlEuoWWjgzYaB/IkeGOrxXhqB+uA9Bfcm0lAZuh+YIeAD+cAqSz4kCMUAAAAASUVORK5CYII=);}

    ul.errorMessages > li {margin-bottom:1.4em;}
    td.t {background:#90ff90;text-align:center;}
    td.c {background:#ff9090;text-align:center;}
    td.t:after {content: '\2713';}
    td.c:after {content: '\2717';}
    img {border:0;}
    .slideshow img {opacity:0;
        position:absolute;
        transition: opacity 1.5s;
        -moz-transition: opacity 1.5s;
        -webkit-transition: opacity 1.5s;
        -o-transition: opacity 1.5s;}
    .slideshow img:first-child {opacity:1;}
    figcaption {font-style:italic; margin-bottom:2em;}
    tr.inactive {color:#888;}
 tr.inactive td.c, tr.inactive td.t {background:#E3E3E3;}
    code.box {margin-left:0em;}
    span[title] {border-bottom: 1px dotted; font-family: sans-serif; cursor:help;}
    dt {margin-bottom:0.5em; margin-top:1em; font-style:italic;}
    dd {margin-bottom:0.8em;}
    abbr {cursor:help;}

    ul {margin-bottom:2em;}
</style>

<!-- libloadorder

    A library for reading and writing the load order of plugin files for
    TES III: Morrowind, TES IV: Oblivion, TES V: Skyrim, Fallout 3 and
    Fallout: New Vegas.

    Copyright (C) 2012    WrinklyNinja

    This file is part of libloadorder.

    libloadorder is free software: you can redistribute
    it and/or modify it under the terms of the GNU General Public License
    as published by the Free Software Foundation, either version 3 of
    the License, or (at your option) any later version.

    libloadorder is distributed in the hope that it will
    be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with libloadorder.  If not, see
    <http://www.gnu.org/licenses/>.
-->

<h1>libloadorder</h1>
<h2>Contents</h2>
<ol>
    <li><a href="#intro">Introduction</a>
    <li><a href="#types">Variable Types</a>
    <li><a href="#memory">Memory Management</a>
    <li><a href="#codes">Library Codes</a>
    <ol>
        <li><a href="#codes-return">Return Codes</a>
        <li><a href="#codes-games">Game Codes</a>
        <li><a href="#codes-load">Load Order Method Codes</a>
    </ol>
    <li><a href="#functions">Functions</a>
    <ol>
        <li><a href="#functions-error">Error Handling Functions</a>
        <li><a href="#functions-version">Version Functions</a>
        <li><a href="#functions-lifecycle">Lifecycle Management Functions</a>
        <li><a href="#functions-activation">Plugin Active Status Functions</a>
        <li><a href="#functions-sorting">Plugin Sorting Functions</a>
    </ol>
    <li><a href="#example">Example Usage</a>
    <li><a href="#contact">Credits</a>
    <li><a href="#license">License</a>
</ol>

<h2 id="intro">Introduction</h2>
<p>libloadorder is a free software library that provides functions for manipulating plugin load order and active status. Its main features are:
<ul>
    <li>C frontend.
    <li>Available as x86 and x64 static and dynamic libraries.
    <li>Supports TES III: Morrowind, TES IV: Oblivion, TES V: Skyrim, Fallout 3 and Fallout: New Vegas.
    <li>Supports total conversions which replace any of the supported games' main master files (eg. Nehrim - At Fate's Edge).
    <li>Provides a uniform interface to the supported games' differing load order systems.
    <li>Supports the community standard textfile-based load order system for TES V: Skyrim.
    <li>Supports ghosted plugins.
    <li>Get/Set the active plugin list.
    <li>Get/Set the full load order.
    <li>Get/Set the load order position of an individual plugin.
    <li>Get/Set the active status of an individual plugin.
    <li>Uses load order and active plugin list caching to avoid unnecessary disk reads, increasing performance.
    <li>Free and open source software licensed under the GNU General Public License v3.0.
</ul>
<p>libloadorder is designed to free modding utility developers from the task of implementing and maintaining their own code for the functionality it provides. It is one component of the <q>Community Mod Utility Libraries</q>, and is <a href="https://github.com/WrinklyNinja/libloadorder">available on GitHub</a>.
<p>This documentation assumes a familiarity with the basics of load ordering. An introduction to the concepts involved may be found in the <a href="textfile-standard.html">Textfile-based Load Order Standard</a>.
<p><strong>Note</strong>: libloadorder is <strong>not</strong> thread safe. Thread safety is a goal, but one that has not yet been achieved. Bear this in mind if using it in a multi-threaded client.


<h2 id="types">Variable Types</h2>
<p>libloadorder uses character strings and integers for information input/output.
<ul>
    <li>All strings are unsigned 8-bit character strings (char*) encoded in UTF-8 and are null-terminated.
    <li>All codes are unsigned 32-bit integers (unsigned int).
    <li>All array sizes and positions use the unsigned data type size_t.
    <li>File paths are case-sensitive if and only if the underlying file system is case-sensitive.
</ul>
<p>libloadorder also introduces one new structure:
<code class="box" id="game_handle">typedef struct Game * game_handle;</code>
<p>The game_handle structure abstracts the definition of libloadorder's internal state while still providing type safety across the library's functions.


<h2 id="memory">Memory Management</h2>
<p>libloadorder manages the memory of strings and arrays it returns internally, so such strings and arrays should not be deallocated by the client.
<p>A string or array outputted by libloadorder lasts until the next call to a function which outputs data of the same type, eg. a string will last until a function outputting a string is called. <a href="#lo_destroy_handle">lo_destroy_handle</a> will also destroy all outputted strings and arrays.
<p>The one exception to the above is the string outputted by <a href="#lo_get_error_message">lo_get_error_message</a>. This string is allocated independently of all other strings, so lasts until the next call to <a href="#lo_get_error_message">lo_get_error_message</a> or until <a href="#lo_cleanup">lo_cleanup</a> is called. It is not destroyed by <a href="#lo_destroy_handle">lo_destroy_handle</a>.


<h2 id="codes">Library Codes</h2>
<h3 id="codes-return">Return Codes</h3>
<p>libloadorder functions use the following unsigned int return codes to signal how a function completes. WARN return codes signify a problem that did not cause the function to exit prematurely, whereas ERROR return codes signify issues that did cause the function to exit prematurely. When a function exits prematurely, a reversal of changes made during its prior execution is attempted.
<table>
    <thead><tr><th>Return Code<th>Description
    <tbody>
        <tr><td>LIBLO_OK                                <td>The function completed successfully.
        <tr><td>LIBLO_WARN_BAD_FILENAME             <td>A plugin filename contains characters that do not have Windows-1251/1252 code points. The plugin cannot be activated.
        <tr><td>LIBLO_WARN_LO_MISMATCH              <td>This return code can only ever be encountered when using libloadorder with a game that uses the textfile-based load order system. It is only ever returned by <a href="#lo_create_handle">lo_create_handle</a>, and signifies that the load order in the active plugins list file (eg. <q>plugins.txt</q>) is not equivalent to the load order in the full load order file (eg. <q>loadorder.txt</q>). Synchronisation of the two is automatic when load order is managed through libloadorder, but other utilities (eg. the Skyrim launcher) may cause desync to occur. See the <a href="textfile-standard.html">Textfile-based Load Order Standard</a> for more information.
        <tr><td>LIBLO_ERROR_FILE_READ_FAIL          <td>A file could not be read.
        <tr><td>LIBLO_ERROR_FILE_WRITE_FAIL         <td>A file could not be written to.
        <tr><td>LIBLO_ERROR_FILE_RENAME_FAIL    <td>A file could not be renamed.
        <tr><td>LIBLO_ERROR_PARSE_FAIL              <td>There was an error parsing the file.
        <tr><td>LIBLO_ERROR_FILE_NOT_UTF8           <td>The specified file is not encoded in UTF-8.
        <tr><td>LIBLO_ERROR_FILE_NOT_FOUND          <td>The specified file could not be found.
        <tr><td>LIBLO_ERROR_TIMESTAMP_READ_FAIL     <td>The modification date of a file could not be read.
        <tr><td>LIBLO_ERROR_TIMESTAMP_WRITE_FAIL        <td>The modification date of a file could not be set.
        <tr><td>LIBLO_ERROR_NO_MEM                  <td>The library was unable to allocate the required memory.
        <tr><td>LIBLO_ERROR_INVALID_ARGS                <td>Invalid arguments were given for the function.
        <tr><td>LIBLO_RETURN_MAX                        <td>Matches the value of the highest-numbered return code. Provided in case clients wish to incorporate additional return codes in their implementation and desire some method of avoiding value conflicts.
</table>
<h3 id="codes-game">Game Codes</h3>
<p>The following unsigned int codes are used by <a href="#lo_create_handle">lo_create_handle</a> to specify which game the handle is for, in cases where distinctions between games are necessary.
<table>
    <thead><tr><th>Game Code<th>Game
    <tbody>
        <tr><td>LIBLO_GAME_TES3 <td>The Elder Scrolls III: Morrowind
        <tr><td>LIBLO_GAME_TES4 <td>The Elder Scrolls IV: Oblivion
        <tr><td>LIBLO_GAME_TES5 <td>The Elder Scrolls V: Skyrim
        <tr><td>LIBLO_GAME_FO3  <td>Fallout 3
        <tr><td>LIBLO_GAME_FNV  <td>Fallout: New Vegas
</table>
<h3 id="codes-load">Load Order Method Codes</h3>
<p>The following codes are used by <a href="#lo_get_load_order_method">lo_get_load_order_method</a> to signify which load order system the game handle is using.
<table>
    <thead><tr><th>Load Order Method Code<th>Description
    <tbody>
        <tr><td>LIBLO_METHOD_TIMESTAMP<td>The game handle is using the timestamp-based load order system. Morrowind, Oblivion, Fallout 3 and Fallout: New Vegas all use this system, as does pre-v1.4.26 Skyrim.
        <tr><td>LIBLO_METHOD_TEXTFILE<td>The game handle is using the textfile-based load order system. Skyrim v1.4.26+ uses this system.
</table>



<h2 id="functions">Functions</h2>
<p>libloadorder provides the functions listed below to clients. Where a function returns a unsigned int value, this is the function's return code.

<h3 id="functions-error">Error Handling Functions</h3>
<dfn id="lo_get_error_message">lo_get_error_message</dfn> - Outputs a string giving the details of the last time an error or warning return code was returned by a function.
<code class="box">unsigned int <a href="#lo_get_error_message">lo_get_error_message</a> (char ** details);</code>
<ul>
    <li><var>details</var> - A pointer to the error details string outputted by the function.
</ul>

<dfn id="lo_cleanup">lo_cleanup</dfn> - Frees the memory allocated to the last error details string.
<code class="box">void <a href="#lo_cleanup">lo_cleanup</a> ();</code>
<ul>
    <li><var>details</var> - A pointer to the error details string outputted by the function.
</ul>

<h3 id="functions-version">Version Functions</h3>
<dfn id="lo_is_compatible">lo_is_compatible</dfn> - Returns whether this version of libloadorder is compatible with the given version of libloadorder. Abstracts library stability policy away from clients.
<code class="box">bool <a href="#lo_is_compatible">lo_is_compatible</a> (const unsigned int bossVersionMajor, const unsigned int bossVersionMinor, const unsigned int bossVersionPatch);</code>
<ul>
    <li><var>versionMajor</var> - The major version number (<b>major</b>.minor.patch) of the library version the client's code was written for.
    <li><var>versionMinor</var> - The minor version number (major.<b>minor</b>.patch) of the library version the client's code was written for.
    <li><var>versionPatch</var> - The patch version number (major.minor.<b>patch</b>) of the library version the client's code was written for.
</ul>

<dfn id="lo_get_version">lo_get_version</dfn> - Returns the version numbers for the loaded version of libloadorder.
<code class="box">unsigned int <a href="#lo_get_version">lo_get_version</a> (unsigned int * versionMajor, unsigned int * versionMinor, unsigned int * versionPatch);</code>
<ul>
    <li><var>versionMajor</var> - The major version number (<b>major</b>.minor.patch) of the library.
    <li><var>versionMinor</var> - The minor version number (major.<b>minor</b>.patch) of the library.
    <li><var>versionPatch</var> - The patch version number (major.minor.<b>patch</b>) of the library.
</ul>

<h3 id="functions-lifecycle">Lifecycle Management Functions</h3>
<dfn id="lo_create_handle">lo_create_handle</dfn> - Creates a handle for one of the games supported by the library. If the <var>gameId</var> uses the textfile-based load order system, this function also checks if the two load order files are in sync, provided that they both exist. You can create multiple game handles, including for the same game, but remember that libloadorder is not thread safe.
<code class="box">unsigned int <a href="#lo_create_handle">lo_create_handle</a> (game_handle * gh, const unsigned int gameId, const char * gamePath);</code>
<ul>
    <li><var>db</var> - A pointer to the handle created by the function.
    <li><var>gameId</var> - A game code specifying which game to create the handle for.
    <li><var>gamePath</var> - A string containing the relative or absolute path to the game folder.
</ul>

<dfn id="lo_destroy_handle">lo_destroy_handle</dfn> - Destroys the given handle, freeing any memory allocated as part of its use.
<code class="box">void <a href="#lo_destroy_handle">lo_destroy_handle</a> (game_handle gh);</code>
<ul>
    <li><var>gh</var> - The game handle to be destroyed.
</ul>

<dfn id="lo_set_game_master">lo_set_game_master</dfn> - Sets the game's master file to a given filename, eg. for use with total conversions where the original main master file is replaced with one of a different filename.
<code class="box">unsigned int <a href="#lo_set_game_master">lo_set_game_master</a> (game_handle gh, const char * masterFile);</code>
<ul>
    <li><var>gh</var> - The game handle to be destroyed.
    <li><var>masterFile</var> - The filename of the replacement main master file.
</ul>


<h3 id="functions-activation">Plugin Activity Functions</h3>
<p>These functions require a game handle. Ghosted plugins can be passed using their ghosted or unghosted filenames.
<p>libloadorder's client interface treats the active plugin list as an unordered set of plugin filenames, so the order of plugins in the inputted and outputted arrays of the functions below holds no significance.
<p>Note that the functions <a href="#lo_get_active_plugins">lo_get_active_plugins</a> and <a href="#lo_get_plugin_active">lo_get_plugin_active</a> may output data from an invalid active plugin list, but <a href="#lo_set_active_plugins">lo_set_active_plugins</a> and <a href="#lo_set_plugin_active">lo_set_plugin_active</a> will return with an error if their operation would result in an invalid active plugin list. A valid active plugin list is one that meets all of the following conditions:
<ul>
    <li>Contains only installed plugins.
    <li>Contains no duplicate entries.
    <li>Contains no more than 255 plugins.
    <li>If for Skyrim, contains <code>Skyrim.esm</code>.
    <li>If for Skyrim and <code>Update.esm</code> is installed, contains <code>Update.esm</code>.
</ul>

<dfn id="lo_get_active_plugins">lo_get_active_plugins</dfn> - Gets an array of all plugins in the active plugin list.
<code class="box">unsigned int <a href="#lo_get_active_plugins">lo_get_active_plugins</a> (game_handle gh, char *** plugins, size_t * numPlugins);</code>
<ul>
    <li><var>gh</var> - The handle the function acts on.
    <li><var>plugins</var> - The outputted array of active plugins. If <var>numPlugins</var> is 0, this will be <code>NULL</code>.
    <li><var>numPlugins</var> - The size of the outputted <var>plugins</var> array.
</ul>

<dfn id="lo_set_active_plugins">lo_set_active_plugins</dfn> - Replaces the contents of the active plugin list with the given plugins.
<code class="box">unsigned int <a href="#lo_set_active_plugins">lo_set_active_plugins</a> (game_handle gh, char ** plugins, const size_t numPlugins);</code>
<ul>
    <li><var>gh</var> - The handle the function acts on.
    <li><var>plugins</var> - The inputted array of plugins to be made active.
    <li><var>numPlugins</var> - The size of the <var>plugins</var> array.
</ul>

<dfn id="lo_get_plugin_active">lo_get_plugin_active</dfn> - Checks to see if the given plugin is in the active plugin list.
<code class="box">unsigned int <a href="#lo_get_plugin_active">lo_get_plugin_active</a> (game_handle gh, const char * plugin, bool * result);</code>
<ul>
    <li><var>gh</var> - The handle the function acts on.
    <li><var>plugin</var> - A string containing the filename of the plugin to check the active/inactive status of.
    <li><var>isActive</var> - A pointer to the boolean output. The output is <code>true</code> if the plugin is active, and <code>false</code> otherwise.
</ul>

<dfn id="lo_set_plugin_active">lo_set_plugin_active</dfn> - If <var>active</var> is true, activates the given plugin if it is not already active. If <var>active</var> is false, deactivates the plugin if it is not already inactive. If the given plugin is already of the status it is being set to, its status is simply not changed. If activating a plugin that is ghosted, the <code>.ghost</code> extension is removed.
<code class="box">unsigned int <a href="#lo_set_plugin_active">lo_set_plugin_active</a> (game_handle gh, const char * plugin, const bool active);</code>
<ul>
    <li><var>gh</var> - The handle the function acts on.
    <li><var>plugin</var> - A string containing the filename of the plugin to change the active/inactive status of.
    <li><var>active</var> - Whether to activate or deactivate the plugin. If <code>true</code>, then the plugin is activated if it is not already active. If <code>false</code>, the plugin is deactivated unless it is already inactive.
</ul>

<h3 id="functions-sorting">Plugin Sorting Functions</h3>
<p>These functions require a game handle. Ghosted plugins can be passed using their ghosted or unghosted filenames.</p>
<p>libloadorder's client interface uses a zero-based indexing system, so the first plugin in the load order has position <code>0</code>.
<p>Note that the functions <a href="#lo_get_load_order">lo_get_load_order</a>, <a href="#lo_get_plugin_position">lo_get_plugin_position</a> and <a href="#lo_get_indexed_plugin">lo_get_indexed_plugin</a> may output data from an invalid load order, but <a href="#lo_set_load_order">lo_set_load_order</a> and <a href="#lo_set_plugin_position">lo_set_plugin_position</a> will return with an error if their operation would result in an invalid load order. A valid load order is one that meets all of the following conditions:
<ul>
    <li>Contains only installed plugins.
    <li>Contains no duplicate entries.
    <li>The first plugin in the load order must be the game's main master file. <small>Use <a href="#lo_set_game_master">lo_set_game_master</a> before manipulating load order if the main master file in use does not have the same filename as the original.</small>
    <li>Loads all master files before all plugin files. <small>Master bit flag value, rather than file extension, is checked.</small>
</ul>

<dfn id="lo_get_load_order_method">lo_get_load_order_method</dfn> - Returns which method BOSS is using for the load order.
<code class="box">unsigned int <a href="#lo_get_load_order_method">lo_get_load_order_method</a> (game_handle gh, unsigned int * method);</code>
<ul>
    <li><var>gh</var> - The handle the function acts on.
    <li><var>method</var> - A pointer to the load order method code for the load order system that is being used by the handle <var>gh</var>.
</ul>

<dfn id="lo_get_load_order">lo_get_load_order</dfn> - Outputs the current load order.
<code class="box">unsigned int <a href="#lo_get_load_order">lo_get_load_order</a> (game_handle gh, char *** plugins, size_t * numPlugins);</code>
<ul>
    <li><var>gh</var> - The handle the function acts on.
    <li><var>plugins</var> - A pointer to the outputted array of plugins in load order. If <var>numPlugins</var> is 0, this will be <code>NULL</code>. The outputted load order may be invalid.
    <li><var>numPlugins</var> - A pointer to the size of the outputted <var>plugins</var> array.
</ul>

<dfn id="lo_set_load_order">lo_set_load_order</dfn> - Sets the load order to the passed plugin array, then scans the plugins directory and inserts any plugins not included in the passed array. Plugin files are inserted at the end of the load order, and master files are inserted after the last master file in the load order. The order of plugin insertion is undefined besides the distinction made between master files and plugin files.
<code class="box">unsigned int <a href="#lo_set_load_order">lo_set_load_order</a> (game_handle gh, char ** plugins, const size_t numPlugins);</code>
<ul>
    <li><var>gh</var> - The handle the function acts on.
    <li><var>plugins</var> - The inputted array of plugins in their new load order. This load order must be valid.
    <li><var>numPlugins</var> - The size of the <var>plugins</var> array.
</ul>

<dfn id="lo_get_plugin_position">lo_get_plugin_position</dfn> - Gets the current load order position of the specified plugin.
<code class="box">unsigned int <a href="#lo_get_plugin_position">lo_get_plugin_position</a> (game_handle gh, const char * plugin, size_t * index);</code>
<ul>
    <li><var>gh</var> - The handle the function acts on.
    <li><var>plugin</var> - A string containing the filename of the plugin to get the load order position of.
    <li><var>index</var> - A pointer to the outputted load order index of the inputted plugin.
</ul>

<dfn id="lo_set_plugin_position">lo_set_plugin_position</dfn> - Sets the load order position of the specified plugin.
<code class="box">unsigned int <a href="#lo_set_plugin_position">lo_set_plugin_position</a> (game_handle gh, const char * plugin, const size_t index);</code>
<ul>
    <li><var>gh</var> - The handle the function acts on.
    <li><var>plugin</var> - A string containing the filename of the plugin to set the load order of.
    <li><var>index</var> - The load order index to be set for the inputted plugin. If the index specified is greater than the number of plugins in the load order, the plugin will be inserted at the end of the load order.
</ul>

<dfn id="lo_get_indexed_plugin">lo_get_indexed_plugin</dfn> - Gets the filename of the plugin is at the specified load order position.
<code class="box">unsigned int <a href="#lo_get_indexed_plugin">lo_get_indexed_plugin</a> (game_handle gh, const size_t index, char ** plugin);</code>
<ul>
    <li><var>gh</var> - The handle the function acts on.
    <li><var>index</var> - The load order index to be looked at.
    <li><var>plugin</var> - A pointer to the outputted filename of the plugin at <var>index</var> in the load order.
</ul>


<h2 id="example">Example Usage</h2>
<p>The source code of the <code>libloadorder-tester</code> application provides a very simple example of libloadorder usage, both by using the library's C interface directly and by using a C++ wrapper that allows a neater implementation in a C++-based project. The source code for <code>libloadorder-tester</code> is hosted alongside the libloadorder source code.
<p>More complex usage examples are to follow.

<h2 id="credits">Credits</h2>
<p>libloadorder is written by WrinklyNinja, with code contribution from Leandro Conde. libloadorder is written in C/C++ and makes use of the <a href="http://utfcpp.sourceforge.net/">UTF8-CPP</a> library and some of the <a href="http://www.boost.org/">Boost</a> libraries.

<h2 id="license">License</h2>
<p>libloadorder is distributed under the <a href="http://www.gnu.org/licenses/gpl.html">GNU General Public License v3.0</a>. For the full text of the license, see the included <q>LICENSE</q> file.

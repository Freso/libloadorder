# Changelog

## [10.0.0] - Unreleased

## Added

- `lo_free_string()` must be used to free the memory allocated by any API
  function that outputs a C string, excluding `lo_get_error_message()`.
- `lo_free_string_array()` must be used to free the memory allocated by any API
  function that outputs an array of C strings.
- New C API error codes:

  - `LIBLO_ERROR_POISONED_THREAD_LOCK`
  - `LIBLO_ERROR_IO_ERROR`
  - `LIBLO_ERROR_IO_PERMISSION_DENIED`
  - `LIBLO_ERROR_TEXT_ENCODE_FAIL`
  - `LIBLO_ERROR_TEXT_DECODE_FAIL`
  - `LIBLO_ERROR_INTERNAL_LOGIC_ERROR`

## Changed

- libloadorder has been rewritten in Rust.
- Attempting to write a plugin filename that cannot be encoded in Windows-1252
  is now a hard error, instead of that filename getting skipped and a warning
  code being returned.
- Memory allocation failure now causes a panic instead of returning an error
  code.
- C strings and arrays of C strings output by API game handle functions now have
  indefinite lifetime and must be explicitly freed using the provided API
  functions. Previous behaviour was that such output would be stored in
  thread-local storage until the next time the same data type was outputted, or
  until the associated game handle was destroyed.
- The C string output of `lo_get_error_message()` no longer needs to be
  explicitly freed.
- The C/C++ headers have been replaced with one C header (`libloadorder.h`) and
  one C++ header (`libloadorder.hpp`).
- Many API function parameters have lost `const` qualifiers due to the C/C++
  headers being autogenerated and changes to string ownership.
- The library binary name has changed. Omitting
  platform-specific prefixes and suffixes, it is now `loadorder_ffi`.
- The documentation has been converted to Markdown and split up: the API
  reference documentation is stored with the code and generated by rustdoc, and
  the general load order documentation is now stored in `/doc` and generated
  by [mdBook](https://azerupi.github.io/mdBook/).

## Removed

- `lo_set_game_master()` was removed as it had no effect.
- `lo_is_compatible()` was removed as it was unnecessary as the library uses
  semantic versioning.
- `lo_cleanup()` was removed as it was made obsolete.
- Caching of plugin folder, active plugins file and load order file content, as
  profiling showed it was no longer effective.
- Some error codes were removed or replaced:

  - `LIBLO_WARN_BAD_FILENAME` is now indicated by `LIBLO_ERROR_TEXT_ENCODE_FAIL`
  - `LIBLO_ERROR_FILE_READ_FAIL` is now indicated by `LIBLO_ERROR_IO_ERROR`
  - `LIBLO_ERROR_FILE_WRITE_FAIL` is now indicated by `LIBLO_ERROR_IO_ERROR`,
    `LIBLO_ERROR_IO_PERMISSION_DENIED` and `LIBLO_ERROR_TEXT_DECODE_FAIL`
  - `LIBLO_ERROR_TIMESTAMP_READ_FAIL` is now indicated by `LIBLO_ERROR_IO_ERROR`
  - `LIBLO_ERROR_NO_MEM` is obsolete as the Rust implementation panics on
    memory allocation failure
  - `LIBLO_WARN_INVALID_LIST` was unused for a few major versions

## Fixed

- Attempting to deactivate an implicitly active plugin that is not installed now
  causes an error.
- Attempting to set the active plugins giving an array including an implicitly
  active plugin that is not installed now causes an error.
